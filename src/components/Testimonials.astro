---
interface Props {
  locale?: string;
}

const { locale = "es" } = Astro.props;

const translations = await import(`../locales/${locale}.json`);
const t = translations.default;

interface Testimonial {
  message: string;
  name: string;
  email: string;
}

const testimonials: Testimonial[] = t.testimonials.items;
---

<div class="testimonials-slider-wrapper relative overflow-hidden py-10">
  <div class="testimonials-track flex gap-8 transition-transform duration-700 ease-out cursor-grab active:cursor-grabbing">
    {
      testimonials.map((testimonial, index) => (
        <div class="testimonial-card flex-shrink-0 w-[350px] md:w-[450px] group relative">
          <div class="relative h-full bg-[#111111] border border-white/10 rounded-3xl p-8 lg:p-10 transition-all duration-500 hover:border-purple-500/50 hover:bg-[#161616] overflow-hidden">
            <!-- Decorative Background -->
            <div class="absolute -top-24 -right-24 w-48 h-48 bg-purple-600/10 rounded-full blur-3xl group-hover:bg-purple-600/20 transition-colors duration-500"></div>
            
            <!-- Quote Icon -->
            <div class="mb-8">
              <svg class="w-10 h-10 text-purple-500/40 group-hover:text-purple-500 transition-colors duration-500" fill="currentColor" viewBox="0 0 24 24">
                <path d="M14.017 21L14.017 18C14.017 16.8954 14.9124 16 16.017 16H19.017C19.5693 16 20.017 15.5523 20.017 15V9C20.017 8.44772 19.5693 8 19.017 8H16.017C14.9124 8 14.017 7.10457 14.017 6V3H21.017V15C21.017 18.3137 18.3307 21 15.017 21H14.017ZM3.01709 21V18C3.01709 16.8954 3.91252 16 5.01709 16H8.01709C8.56937 16 9.01709 15.5523 9.01709 15V9C9.01709 8.44772 8.56937 8 8.01709 8H5.01709C3.91252 8 3.01709 7.10457 3.01709 6V3H10.0171V15C10.0171 18.3137 7.3308 21 4.01709 21H3.01709Z" />
              </svg>
            </div>

            <!-- Message -->
            <p class="text-lg md:text-xl text-white/80 leading-relaxed mb-10 group-hover:text-white transition-colors duration-500 italic" data-t={`testimonials.items.${index}.message`}>
              "{testimonial.message}"
            </p>

            <!-- Author -->
            <div class="flex items-center gap-4 mt-auto">
              <div class="w-14 h-14 rounded-2xl bg-gradient-to-br from-purple-600 to-blue-600 flex items-center justify-center text-white font-bold text-xl shadow-lg shadow-purple-500/20">
                {testimonial.name.charAt(0)}
              </div>
              <div>
                <h4 class="text-white font-bold text-lg" data-t={`testimonials.items.${index}.name`}>{testimonial.name}</h4>
                <p class="text-purple-400 text-sm font-medium" data-t={`testimonials.items.${index}.email`}>{testimonial.email}</p>
              </div>
            </div>
          </div>
        </div>
      ) )
    }
  </div>

  <!-- Navigation Controls -->
  <div class="flex justify-center gap-4 mt-12">
    <button id="prev-testimonial" class="w-12 h-12 rounded-full border border-white/10 flex items-center justify-center text-white hover:bg-white/5 hover:border-purple-500/50 transition-all duration-300">
      <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" /></svg>
    </button>
    <button id="next-testimonial" class="w-12 h-12 rounded-full border border-white/10 flex items-center justify-center text-white hover:bg-white/5 hover:border-purple-500/50 transition-all duration-300">
      <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" /></svg>
    </button>
  </div>
</div>

<script>
  function initTestimonials() {
    const track = document.querySelector('.testimonials-track') as HTMLElement;
    const prevBtn = document.getElementById('prev-testimonial');
    const nextBtn = document.getElementById('next-testimonial');
    
    if (!track || !prevBtn || !nextBtn) return;

    let currentIndex = 0;
    const cards = track.querySelectorAll('.testimonial-card');
    const cardWidth = (cards[0] as HTMLElement).offsetWidth + 32; // width + gap

    function updateSlider() {
      const maxIndex = cards.length - Math.floor(track.parentElement!.offsetWidth / cardWidth);
      if (currentIndex < 0) currentIndex = 0;
      if (currentIndex > maxIndex) currentIndex = maxIndex;
      
      track.style.transform = `translateX(-${currentIndex * cardWidth}px)`;
    }

    prevBtn.addEventListener('click', () => {
      currentIndex--;
      updateSlider();
    });

    nextBtn.addEventListener('click', () => {
      currentIndex++;
      updateSlider();
    });

    // Handle resize
    window.addEventListener('resize', updateSlider);
    
    // Initial update
    updateSlider();
  }

  initTestimonials();
  document.addEventListener('astro:after-swap', initTestimonials);
</script>
